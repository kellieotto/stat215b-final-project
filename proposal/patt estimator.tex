\documentclass{article}
\usepackage{color}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage[margin=0.75in]{geometry}

\newcommand{\ind}{\mathbb{I}} % Indicator function
\newcommand{\pr}{P} % Generic probability
\newcommand{\ex}{E} % Generic expectation
\newcommand\independent{\protect\mathpalette{\protect\independenT}{\perp}}
\def\independenT#1#2{\mathrel{\rlap{$#1#2$}\mkern2mu{#1#2}}}


\title{Estimating PATT with noncompliance}
%\date{}               

\begin{document}
\maketitle


\section{Assumptions}
Let $Y_{ist}$ be the potential outcome for individual $i$ in group $s$, where $s=0$ for the population and $s=1$ for the randomized control trial, and $t$ be the treatment assigned.  Let $W_i^T$ and $W_i^C$ denote individual $i$'s observable covariates related to the sample selection mechanism for membership in the RCT under treatment and control assignment, respectively.  For a generic value, we drop the subscript $i$.  \\

Let $C_i$ be an indicator for individual $i$'s compliance to treatment.  In the population $S=0$, it doesn't make sense to talk about compliance, as treatment isn't assigned at random.  Compliance is only observable for individuals in the RCT, $S=1$.


We make the following assumptions:
\begin{itemize}
\item{Consistency under parallel studies: for all $i$ and for $t=0, 1$,
\begin{equation}\label{consistency}
Y_{i0t} = Y_{i1t}
\end{equation}}
\item{Strong ignorability of sample assignment for treated:
\begin{equation}\label{si_treat}
(Y_{01}, Y_{11}) \independent S \mid (W^T, T=1), 0 < \pr(S=1 \mid W^T, T=1) <1 
\end{equation}}
\item{Strong ignorability of sample assignment for controls:
\begin{equation}\label{si_ctrl}
(Y_{00}, Y_{10}) \independent S \mid (W^C, T=1), 0 < \pr(S=1 \mid W^C, T=1) <1 
\end{equation}}
\item{Stable unit treatment value assumption (SUTVA):
\begin{equation}\label{sutva}
Y_{ist}^{L_i} = Y_{ist}^{L_j},  \forall i \neq j
\end{equation}
where $L_j$ is the treatment and sample assignment vector for unit $j$.  This means that the treatment assignment for all other individuals $j$ does not affect the potential outcomes of individual $i$.}
\item{Conditional independence of compliance and assignment:
\begin{equation}\label{compl}
C \independent (S=1, T=1) \mid (W^T, W^C), 0 < \pr(C = 1 \mid (W^T, W^C)) < 1
\end{equation}
}
\item{Monotonicity: Assume that there are no defiers, and crossover is only possible from treatment to control.}
\item{Exclusion restriction (ER): For non-compliers, $Y_{11} = Y_{10}$.  A treatment effect is may only be non-zero for compliers.}
\end{itemize}




\section{Estimation}

The estimand of interest is 

\begin{equation}
\tau_{\text{PATT}} = \ex\left( Y_{01} - Y_{00} \mid S=0, T=1\right)
\end{equation}

\begin{align*}
\ex\left(Y_{01} \mid S=0, T=1\right) &= \ex\left(Y_{11} \mid S=0, T=1\right) \tag*{by \eqref{consistency}} \\
&= \ex_{01}\left[  \ex\left(Y_{11} \mid S=1, T=1, W^T\right) \right] \tag*{by \eqref{si_treat}} \\
&= \ex_{01}\left[\ex_{C}\left[  \ex\left(Y_{11} \mid S=1, T=1, W^T, C\right) \right]\right]  \\
&= \ex_{01}\left[  \pr(C=1 \mid W^T) \ex\left(Y_{11} \mid S=1, T=1, W^T, C=1\right)\right. \\& \qquad+ \left.(1-\pr(C=1 \mid W^T))\ex\left(Y_{10} \mid S=1, T=1, W^T, C=0\right) \right]  \tag*{by \eqref{compl}} \\
&= \ex_{01}\left[  \pr(C=1 \mid W^T) \ex\left(Y_{11} \mid S=1, T=1, W^T, C=1\right)\right. \\& \qquad+ \left.(1-\pr(C=1 \mid W^T))\ex\left(Y_{11} \mid S=1, T=1, W^T, C=0\right) \right]  \tag*{by ER} \\
\end{align*}

\begin{align*}
\ex\left(Y_{00} \mid S=0, T=1\right) &= \ex\left(Y_{10} \mid S=0, T=1\right) \tag*{by \eqref{consistency}} \\
&= \ex_{01}\left[  \ex\left(Y_{10} \mid S=1, T=1, W^C\right) \right] \tag*{by \eqref{si_ctrl}} \\
&= \ex_{01}\left[  \ex\left(Y_{10} \mid S=1, T=0, W^C\right) \right] \tag*{by randomization, i.e. $Y_{10} \independent T \mid (W^C, S=1)$} \\
&= \ex_{01}\left[ \ex_{C}\left[  \ex\left(Y_{10} \mid S=1, T=0, W^C, C\right) \right]\right] \\
&=  \ex_{01}\left[  \pr(C = 1\mid W^C) \ex\left(Y_{10} \mid S=1, T=0, W^C, C=1\right)\right. \\&\qquad \left. + (1-\pr(C=1 \mid W^C)) \ex\left(Y_{10} \mid S=1, T=0, W^C, C=0\right) \right]   \tag*{by \eqref{compl}} \\\\
\end{align*}


If we additionally assume that 
$$\ex\left(Y_{10} \mid S=1, T=1, W^T, C=0\right) = \ex\left(Y_{10} \mid S=1, T=0, W^C, C=0\right)$$

then the terms corresponding to the non-compliers cancel and

\begin{equation}\label{patt}
\tau_{\text{PATT}} = \ex_{01}\left[  \pr(C=1 \vert W^T) \ex\left(Y_{11} \mid S=1, T=1, W^T, C=1\right)\right] -  \ex_{01}\left[ \pr(C=1 \vert W^C) \ex\left(Y_{10} \mid S=1, T=0, W^C, C=1\right)\right]
\end{equation}

There are two issues:
\begin{itemize}
\item We must estimate the conditional probability of being a complier given a set of covariates.  This can be done using a standard logistic or probit regression, or can be done using a nonparametric method.
\item We cannot observe who among the RCT controls is a complier or a ``never-treat".  However, the second term in \eqref{patt} involves an expectation over the compliers assigned to control in the RCT.  We will use the model for compliers that we fit previously to predict who among these controls is a complier, given their observed characteristics.
\end{itemize}

\end{document}  